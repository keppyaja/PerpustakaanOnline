<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Perpusri â€” Masuk</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="user-view" style="min-height:100vh; display:flex; align-items:center; justify-content:center; padding:40px;">
        <main class="card" style="max-width:420px; width:100%;">
            <h2 style="margin-bottom:8px;">Masuk ke Perpusri</h2>

            <form id="loginForm" novalidate>
                <label for="email">Email</label>
                <input id="email" name="email" type="email" placeholder="nama@gmail.com" required style="width:100%; padding:10px; margin:6px 0 12px;">
                <label for="password">Kata Sandi</label>
                <input id="password" name="password" type="password" placeholder="Minimal 6 karakter" required style="width:100%; padding:10px; margin:6px 0 12px;">
                <div id="loginError" style="color:#c0392b; margin-bottom:12px; display:none;"></div>

                <!-- tombol Masuk -->
                <button id="loginBtn" type="button" placeholder="Masuk" class="read-button" style="width:100%;">Masuk</button>

                <div style="margin-top:12px; display:flex; justify-content:space-between; align-items:center;">
                    <a href="#" id="forgotLink" style="color:var(--color-primary); text-decoration:none;">Lupa Password?</a>
                    <a href="index.html" style="color:var(--color-text-light); text-decoration:none;">Kembali ke Beranda</a>
                </div>
            </form>
        </main>
    </div>

    <div id="forgotModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); align-items:center; justify-content:center;">
        <div class="card" style="width:360px;">
            <h3>Lupa Password</h3>
            <p style="color:var(--color-text-light);">Masukkan email untuk menerima instruksi reset (simulasi).</p>
            <input id="forgotEmail" type="email" placeholder="nama@contoh.com" style="width:100%; padding:10px; margin:8px 0 12px;">
            <div id="forgotMsg" style="color:var(--color-text-light); margin-bottom:12px;"></div>
            <div style="display:flex; gap:8px;">
                <button id="sendResetBtn" class="read-button" style="flex:1;">Kirim</button>
                <button id="closeForgotBtn" style="flex:1; background:#eee; border:none; padding:10px; border-radius:4px;">Batal</button>
            </div>
        </div>
    </div>

    <!-- ...existing code... -->
    <script src="auth.js"></script>
    <script>
        // Hook UI -> fungsi di auth.js
        const loginBtn = document.getElementById('loginBtn');
        const loginErr = document.getElementById('loginError');
        const forgotLink = document.getElementById('forgotLink');
        const forgotModal = document.getElementById('forgotModal');
        const forgotEmail = document.getElementById('forgotEmail');
        const forgotMsg = document.getElementById('forgotMsg');
        const sendResetBtn = document.getElementById('sendResetBtn');
        const closeForgotBtn = document.getElementById('closeForgotBtn');

        // Saat tombol Masuk diklik, ambil input dan panggil authLogin()
        loginBtn.addEventListener('click', () => {
            loginErr.style.display = 'none';
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            // authLogin menentukan role (admin/user) berdasarkan kredensial
            const res = authLogin(email, password);
            if (res.ok) {
                // Semua role (termasuk admin) diarahkan ke index.html
                window.location.href = 'index.html';
            } else {
                // tampilkan pesan error jika gagal
                loginErr.textContent = res.error;
                loginErr.style.display = 'block';
            }
        });

        // Buka modal lupa password
        forgotLink.addEventListener('click', (e) => {
            e.preventDefault();
            forgotModal.style.display = 'flex';
            forgotMsg.textContent = '';
            forgotEmail.value = '';
        });

        // Tutup modal
        closeForgotBtn.addEventListener('click', () => forgotModal.style.display = 'none');

        // Kirim permintaan reset (disimulasikan)
        sendResetBtn.addEventListener('click', async () => {
            const email = forgotEmail.value;
            const r = await sendPasswordReset(email); // fungsi async di auth.js
            if (r.ok) {
                forgotMsg.style.color = 'green';
                forgotMsg.textContent = 'Instruksi reset telah dikirim (simulasi). Periksa email Anda.';
            } else {
                forgotMsg.style.color = '#c0392b';
                forgotMsg.textContent = r.error;
            }
        });
    </script>
<!-- ...existing code... -->
</body>
</html>